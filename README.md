# Проектная работа "Веб-ларек"

Стек: HTML, SCSS, TS, Webpack

Структура проекта:

- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом

Важные файлы:

- src/pages/index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/index.ts — точка входа приложения
- src/scss/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Установка и запуск

Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

или

```
yarn
yarn start
```

## Сборка

```
npm run build
```

или

```
yarn build
```

## Архитектура

Архитектура приложения основана на паттерне MVP (Model-View-Presenter), что обеспечивает четкое разделение логики, представления и данных. Каждый компонент архитектуры выполняет свою роль, что делает код модульным, тестируемым и поддерживаемым.

### Ключевые особенности архитектуры

- Модульность: Каждый компонент имеет четко определенную ответственность, что упрощает тестирование и поддержку.
- Реактивность: Использование системы событий (`EventEmitter`) позволяет легко уведомлять другие части приложения об изменениях.
- Универсальность: Базовые классы (`Component<T>`, `Model<T>`) обеспечивают повторное использование кода и расширяемость.
- Интеграция с API: Класс `Api` предоставляет унифицированный способ взаимодействия с сервером, включая обработку ошибок.
- Гибкость: Компоненты могут быть легко адаптированы для новых требований благодаря использованию коллбэков, параметров и типизации.

## Базовый код

### 1. Класс `Api`

Класс `Api` представляет собой универсальный инструмент для работы с HTTP-запросами. Он предоставляет методы для выполнения GET и POST-подобных запросов (включая PUT и DELETE) к удаленному серверу. Класс поддерживает настройку базового URL и параметров запроса, таких как заголовки, и предоставляет обработку ответов от сервера.

`constructor(baseUrl: string, options: RequestInit = {})` Конструктор принимает базовый URL (`baseUrl`) для API и опциональные параметры запроса (`options`). Параметры запроса могут включать заголовки, таймауты и другие настройки. Если заголовки не переданы, по умолчанию используется заголовок `'Content-Type': 'application/json'`.

#### Поля класса

- `readonly baseUrl: string` Хранит базовый URL для всех запросов. Этот URL используется как префикс для всех URI, передаваемых в методы `get` и `post`.
- `protected options: RequestInit` Хранит параметры запроса, такие как заголовки, методы и другие настройки. Эти параметры применяются ко всем запросам, выполняемым через экземпляр класса.

#### Методы класса

- `protected handleResponse(response: Response): Promise<object>` Обрабатывает HTTP-ответ от сервера. Если статус ответа успешный (`response.ok`), метод возвращает JSON-данные. В противном случае он создает ошибку, используя поле `error` из JSON-ответа или текст состояния HTTP.
- `get(uri: string)` Выполняет GET-запрос к указанному URI. Метод добавляет URI к базовому URL и отправляет запрос с использованием параметров, определенных в `options`. Результат обрабатывается методом `handleResponse`.
- `post(uri: string, data: object, method: ApiPostMethods = 'POST')` Выполняет POST-, PUT- или DELETE-запрос к указанному URI. Метод принимает данные (`data`), которые будут отправлены в теле запроса, и тип HTTP-метода (`method`). По умолчанию используется метод `POST`. Данные преобразуются в JSON-формат перед отправкой. Результат обрабатывается методом `handleResponse`.

#### Типы, связанные с классом

- `ApiListResponse<Type>` Тип описывает структуру ответа от сервера, содержащего список элементов. Содержит два поля:

  - `total: number` — общее количество элементов.
  - `items: Type[]` — массив элементов типа `Type`.

- `ApiPostMethods` Тип описывает допустимые HTTP-методы для метода `post`: `'POST'`, `'PUT'`, `'DELETE'`.

Класс `Api` предоставляет удобный и унифицированный способ взаимодействия с сервером через HTTP-запросы. Его методы позволяют выполнять основные операции CRUD (создание, чтение, обновление, удаление) с данными, а использование типов, таких как `ApiListResponse<Type>` и `ApiPostMethods`, делает код более безопасным и читаемым.

### 2. Класс `Component<T>`

Класс `Component<T>` представляет собой абстрактный базовый класс для создания компонентов пользовательского интерфейса. Он предоставляет инструментарий для работы с DOM-элементами, такими как управление классами, текстовым содержимым, состоянием блокировки, видимостью, изображениями и т.д. Этот класс является универсальным и может быть расширен для создания специализированных компонентов.

`constructor(protected readonly container: HTMLElement)` Конструктор принимает корневой DOM-элемент компонента, который будет использоваться всеми методами класса для выполнения операций с DOM.

#### Поля класса

- `protected readonly container: HTMLElement` Хранит ссылку на корневой DOM-элемент, который является контейнером для компонента.

#### Методы класса

- `toggleClass(element: HTMLElement, className: string, force?: boolean):void` Переключает указанный класс для элемента. Если параметр `force` не передан, класс будет добавлен, если его нет, и удален, если он уже существует. Если `force` указан, то класс будет добавлен (`true`) или удален (`false`), независимо от текущего состояния.
- `setText(element: HTMLElement, value: unknown): void` Устанавливает текстовое содержимое элемента. Если `value` равно `null` или `undefined`, оно будет преобразовано в пустую строку.
- `setDisabled(element: HTMLElement, state: boolean): void` Блокирует или разблокирует элемент, добавляя или удаляя атрибут `disabled`.
- `setHidden(element: HTMLElement): void` Скрывает элемент, устанавливая его стиль `display` в значение `none`.
- `setVisible(element: HTMLElement): void` Показывает элемент, удаляя свойство `display` из его стилей.
- `setImage(element: HTMLImageElement, src: string, alt?: string): void` Устанавливает атрибут `src` для изображения и, при необходимости, альтернативный текст (`alt`).
- `render(data?: Partial<T>): HTMLElement` Применяет переданные данные к текущему экземпляру компонента (если они есть) и возвращает корневой DOM-элемент. Используется для рендеринга компонента.

Класс `Component<T>` предоставляет мощный и гибкий инструментарий для создания UI-компонентов. Его методы позволяют легко манипулировать DOM-элементами, а абстрактная природа класса делает его удобным для расширения в дочерних классах.

### 3. Класс `EventEmitter`

Класс `EventEmitter` представляет собой реализацию брокера событий, который позволяет подписываться на события, генерировать их и управлять обработчиками. Этот класс предоставляет универсальный механизм для работы с событиями в приложении, поддерживая как точечные подписки на конкретные события, так и глобальные подписки на все события.

`constructor()` Конструктор инициализирует внутреннюю карту `_events`, которая хранит события и связанные с ними обработчики. Карта использует типы `EventName` (строка или регулярное выражение) в качестве ключей и множества обработчиков (`Set<Subscriber>`) в качестве значений.

#### Поля класса

- `_events: Map<EventName, Set<Subscriber>>` Хранит все зарегистрированные события и их обработчики. Ключами являются имена событий (`EventName`), а значениями — множества функций-обработчиков (`Set<Subscriber>`).

#### Методы класса

- `on<T extends object>(eventName: EventName, callback: (event: T) => void): void` Подписывает обработчик на указанное событие. Если событие еще не зарегистрировано, создается новое множество обработчиков. Обработчик добавляется в множество для указанного события.
- `off(eventName: EventName, callback: Subscriber): void` Удаляет обработчик из множества для указанного события. Если после удаления обработчика множество становится пустым, событие удаляется из карты `_events`.
- `emit<T extends object>(eventName: string, data?: T): void` Генерирует событие с указанным именем и данными. Все обработчики, подписанные на это событие, вызываются с переданными данными. Также поддерживаются подписки на все события (`'*'`) и подписки по шаблону (с использованием регулярных выражений).
- `onAll(callback: (event: EmitterEvent) => void): void` Подписывает обработчик на все события. При возникновении любого события будет вызван указанный обработчик с объектом, содержащим имя события и данные.
- `offAll(): void` Очищает все зарегистрированные события и обработчики. Полностью сбрасывает карту `_events`.
- `trigger<T extends object>(eventName: string, context?: Partial<T>): (data: T) => void` Создает функцию-триггер, которая генерирует событие с указанным именем при вызове. Триггер может комбинировать данные, переданные при вызове, с контекстом, указанным при создании триггера.

#### Типы, связанные с классом

- `EventName` Тип описывает имя события. Может быть строкой или регулярным выражением, что позволяет подписываться на события по шаблону.
- `Subscriber` Тип описывает функцию-обработчик события. Обработчик принимает данные, связанные с событием.
- `EmitterEvent` Тип описывает структуру данных, передаваемых в обработчики при подписке на все события ('\*'). Содержит два поля:
  - `eventName: string` — имя события.
  - `data: unknown` — данные, связанные с событием.
- `IEvents` Интерфейс описывает методы, которые должен реализовывать класс `EventEmitter`. Включает методы `on`, `emit` и `trigger`.

Класс `EventEmitter` предоставляет мощный и гибкий механизм для управления событиями в приложении. Его методы позволяют легко подписываться на события, генерировать их и управлять обработчиками, что делает его удобным инструментом для организации взаимодействия между компонентами.

### 4. Класс `Model<T>`

Класс `Model<T>` представляет собой абстрактный базовый класс для создания моделей данных. Он предоставляет механизм для хранения и управления данными, а также интеграции с системой событий через интерфейс `IEvents`. Этот класс позволяет отличать модели от простых объектов данных и уведомлять другие части приложения об изменениях в модели.

`constructor(data: Partial<T>, protected events: IEvents)`
Конструктор принимает частичные данные (`data`) для инициализации модели и экземпляр `IEvents` для работы с событиями. Данные копируются в модель с помощью `Object.assign`, что позволяет гибко задавать начальное состояние.

#### Поля класса

- `protected events: IEvents` Хранит ссылку на экземпляр системы событий (`IEvents`). Используется для уведомления других компонентов о изменениях в модели.

#### Методы класса

- `emitChanges(event: string, payload?: object): void` Генерирует событие, уведомляя подписчиков о том, что модель изменилась. Метод принимает имя события (`event`) и опциональные данные (`payload`). Если данные не переданы, используется пустой объект `{}`. Этот метод позволяет другим компонентам реагировать на изменения в модели.

#### Типы, связанные с классом

- `isModel(obj: unknown): obj is Model<any>` Функция-гарда для проверки, является ли объект экземпляром класса `Model`. Возвращает `true`, если объект является моделью, и `false` в противном случае. Это полезно для типизации и проверки данных в рантайме.
- `IEvents` Интерфейс, описывающий систему событий. Предоставляет методы для подписки на события (`on`), генерации событий (`emit`) и создания триггеров (`trigger`).

Класс `Model<T>` предоставляет универсальный и расширяемый способ управления данными в приложении. Его абстрактная природа позволяет создавать специализированные модели, а интеграция с системой событий делает его удобным для использования в архитектуре MVP или других паттернах, где требуется реактивность.

## Model

### 1. Класс `Basket`

Класс `Basket` представляет собой компонент для управления корзиной товаров в пользовательском интерфейсе. Он наследуется от базового класса `Component<IBasketView>` и предоставляет функциональность для отображения списка товаров, общей стоимости и взаимодействия с кнопкой оформления заказа. Этот класс интегрируется с системой событий через `EventEmitter`, что позволяет уведомлять другие части приложения о действиях пользователя.

`constructor(container: HTMLElement, protected events: EventEmitter)` Конструктор принимает контейнер корзины (`container`) и экземпляр системы событий (`events`).
Внутри конструктора:

- Инициализируются элементы интерфейса: список товаров (`listElement`), поле общей стоимости (`totalElement`) и кнопка оформления заказа (`buttonElement`).
- Добавляются обработчики событий:
  - Клик по кнопке оформления заказа генерирует событие `order:open`, если кнопка активна.
  - Клик по кнопке удаления товара генерирует событие `basket:item-removed`.

#### Поля класса

- `listElement: HTMLElement` Хранит ссылку на элемент, представляющий список товаров в корзине. Используется для динамического добавления или удаления товаров.
- `totalElement: HTMLElement` Хранит ссылку на элемент, отображающий общую стоимость товаров в корзине.
- `buttonElement: HTMLElement` Хранит ссылку на кнопку оформления заказа. Кнопка становится активной только при наличии платных товаров в корзине.
- `buttonClickHandler: () => void` Приватный метод, обрабатывающий клик по кнопке оформления заказа. Генерирует событие `order:open`, если кнопка активна.
- `listClickHandler: (e: MouseEvent) => void` Приватный метод, обрабатывающий клик по списку товаров. Генерирует событие `basket:item-removed` при нажатии на кнопку удаления товара.

#### Методы класса

- `renderItem(item: IBasketItem): HTMLElement` Создает HTML-элемент для отдельного товара в корзине. Элемент содержит название товара, цену (или текст "Бесплатно", если цена равна `null`) и кнопку удаления.
- `updateButtonState(items: IBasketItem[]): void` Обновляет состояние кнопки оформления заказа:
  - Деактивирует кнопку, если корзина пуста или все товары бесплатные.
  - Активирует кнопку, если в корзине есть хотя бы один платный товар.
- `set items(items: IBasketItem[])` Устанавливает список товаров в корзине:
  - Очищает текущий список товаров с помощью метода `replaceChildren`.
  - Добавляет новые товары, вызывая метод `renderItem` для каждого элемента.
  - Если корзина пуста, отображается сообщение "Корзина пуста".
  - Обновляет состояние кнопки оформления заказа.
- `set total(total: number)` Устанавливает отформатированное значение общей стоимости товаров в элемент `totalElement`. Использует функцию `formatNumber` для форматирования числа.
- `render(data: Pick<IBasketView, 'items' | 'total'>): HTMLElement` Основной метод для отображения корзины:
  - Обновляет список товаров, если передан массив `items`.
  - Обновляет общую стоимость, если передано значение `total`.
  - Возвращает контейнер корзины после рендера.

#### Типы, связанные с классом

- `IBasketView` Интерфейс описывает структуру данных, используемую в классе `Basket`. Содержит следующие поля:
  - `items: IBasketItem[]` — массив товаров в корзине.
  - `total: number` — общая стоимость товаров в корзине.
- `IBasketItem` Интерфейс описывает структуру отдельного товара в корзине:
  - `id: string` — уникальный идентификатор товара.
  - `title: string` — название товара.
  - `price: number | null` — цена товара (может быть `null`, если товар бесплатный).
- `EventEmitter` Класс, предоставляющий систему событий. Используется для генерации событий:
  - `order:open` — при клике на кнопку оформления заказа.
  - `basket:item-removed` — при удалении товара из корзины

Класс `Basket` предоставляет удобный и унифицированный способ управления корзиной товаров. Его методы позволяют легко обновлять интерфейс корзины, управлять состоянием кнопки оформления заказа и взаимодействовать с другими компонентами через систему событий. Наследование от `Component<IBasketView>` делает его расширяемым и совместимым с общей архитектурой приложения.

### 2. Класс `ProductModel`

Класс `ProductModel` представляет собой модель для управления продуктами в приложении. Он наследуется от базового класса `Model<IProduct>` и предоставляет инструментарий для загрузки списка продуктов и информации о конкретном продукте с сервера. Этот класс интегрируется с системой событий через `IEvents`, что позволяет уведомлять другие части приложения о результатах операций.

`constructor(data: Partial<IProduct>, events: IEvents, api: WebLarekApi)` Конструктор принимает начальные данные (`data`), экземпляр системы событий (`events`) и объект API (`api`). Внутри конструктора:

- Инициализируется базовый класс `Model<IProduct>` с переданными данными и событиями.
- Сохраняется ссылка на объект API для выполнения запросов к серверу.

#### Поля класса

- `api: WebLarekApi` Хранит ссылку на объект API, который используется для выполнения запросов к серверу. Этот объект предоставляет методы для получения списка продуктов и информации о конкретном продукте.

#### Методы класса

- `async loadProducts(): Promise<{ products: IProduct[] }>` Загружает список продуктов с сервера:
  - Выполняет запрос к API для получения списка продуктов.
  - Генерирует событие `products:loaded` с массивом загруженных продуктов.
  - Возвращает объект, содержащий массив продуктов.
  - В случае ошибки генерирует событие `products:error` и пробрасывает исключение для обработки выше.
- `async loadProductById(id: string): Promise<void>` Загружает информацию о конкретном продукте по его ID:
  - Выполняет запрос к API для получения данных о продукте.
  - Если продукт успешно загружен, генерируется событие `product:loaded` с данными о продукте.
  - Если произошла ошибка (например, продукт не найден), генерируется событие `product:error`.

#### Типы, связанные с классом

- `IProduct` Интерфейс описывает структуру продукта. Содержит следующие поля:
  - `id: string` — уникальный идентификатор продукта.
  - `title: string` — название продукта.
  - `description: string` — описание продукта.
  - `image: string` — путь к изображению продукта.
  - `category: string` — категория продукта.
  - `price: number | null` — цена продукта (может быть `null`, если цена не указана).
- `IEvents` Интерфейс, описывающий систему событий. Предоставляет методы для подписки на события (`on`), генерации событий (`emit`) и создания триггеров (`trigger`).
- `WebLarekApi` Класс, предоставляющий методы для взаимодействия с сервером. Используется для выполнения запросов на получение списка продуктов и информации о конкретном продукте.

Класс `ProductModel` предоставляет удобный и надежный способ управления данными о продуктах. Его методы позволяют легко загружать и обрабатывать информацию о продуктах, а также взаимодействовать с другими компонентами через систему событий. Наследование от `Model<IProduct>` делает его расширяемым и совместимым с общей архитектурой приложения.

### 3. Класс `OrderModel`

Класс `OrderModel` представляет собой модель для управления заказами в приложении. Он наследуется от базового класса `Model<IOrder>` и предоставляет инструментарий для размещения заказов, валидации данных заказа и уведомления других частей приложения о результатах операций. Этот класс интегрируется с системой событий через `IEvents`, что позволяет эффективно взаимодействовать с другими компонентами.

`constructor(data: Partial<IOrder>, events: IEvents, api: WebLarekApi)` Конструктор принимает начальные данные (`data`), экземпляр системы событий (`events`) и объект API (`api`). Внутри конструктора:

- Инициализируется базовый класс `Model<IOrder>` с переданными данными и событиями.
- Сохраняется ссылка на объект API для выполнения запросов к серверу.

#### Поля класса

- `api: WebLarekApi` Хранит ссылку на объект API, который используется для выполнения запросов к серверу. Этот объект предоставляет методы для размещения заказов.

#### Методы класса

- `async placeOrder(orderData: IOrder): Promise<void>` Размещает заказ на сервере:
  - Выполняет запрос к API для отправки данных заказа.
  - Если заказ успешно размещен, генерируется событие `order:success` с данными о созданном заказе.
  - Если произошла ошибка (например, невалидные данные или ошибка сервера), генерируется событие `order:error`.
- `validateOrder(orderData: IOrder): boolean` Проверяет корректность данных заказа:
  - Проверяет обязательные поля (`email`, `phone`, `address`) и наличие товаров в корзине.
  - Если обнаружены ошибки, генерируется событие `formErrors:change` с объектом, содержащим описание ошибок.
  - Возвращает `true`, если данные заказа корректны, и `false`, если есть ошибки.

#### Типы, связанные с классом

- `IOrder` Интерфейс описывает структуру заказа. Содержит следующие поля:
  - `payment: string` — способ оплаты (например, "online" или "cash").
  - `email: string` — электронная почта пользователя.
  - `phone: string` — телефон пользователя.
  - `address: string` — адрес доставки.
  - `total: number` — общая стоимость заказа.
  - `items: string[]` — массив идентификаторов продуктов в заказе.
- `IEvents` Интерфейс, описывающий систему событий. Предоставляет методы для подписки на события (`on`), генерации событий (`emit`) и создания триггеров (`trigger`).
- `WebLarekApi` Класс, предоставляющий методы для взаимодействия с сервером. Используется для выполнения запросов на размещение заказов.

Класс `OrderModel` предоставляет удобный и надежный способ управления заказами. Его методы позволяют легко размещать заказы, проводить валидацию данных и взаимодействовать с другими компонентами через систему событий. Наследование от `Model<IOrder>` делает его расширяемым и совместимым с общей архитектурой приложения.

### 4. Класс AppState

Класс `AppState` представляет собой модель для управления состоянием приложения. Он наследуется от базового класса `Model<IAppState>` и предоставляет инструментарий для работы с каталогом продуктов, корзиной, предпросмотром товаров, заказами и другими аспектами состояния приложения. Этот класс интегрируется с системой событий через `IEvents`, что позволяет уведомлять другие части приложения об изменениях состояния.

`constructor(events: IEvents, productModel: ProductModel, orderModel: OrderModel)` Конструктор принимает экземпляр системы событий (`events`), объект модели продуктов (`productModel`) и объект модели заказов (`orderModel`). Внутри конструктора:

- Инициализируется базовый класс `Model<IAppState>` с начальными данными состояния.
- Сохраняются ссылки на модели продуктов и заказов для выполнения операций с ними.
- Инициализируется внутреннее состояние (`state`) с начальными значениями.

#### Поля класса

- `state: IAppState` Хранит текущее состояние приложения, включая каталог продуктов, корзину, предпросмотр товаров, данные заказа и другие параметры.
- `productModel: ProductModel` Хранит ссылку на объект модели продуктов, который используется для загрузки данных о продуктах.
- `orderModel: OrderModel` Хранит ссылку на объект модели заказов, который используется для размещения и валидации заказов.

#### Методы класса

- `private set(nextState: Partial<IAppState>): void` Обновляет текущее состояние приложения, объединяя новое состояние с существующим. После обновления генерируется событие `state:updated` с новым состоянием.
- `loadProducts(): void` Загружает список продуктов с помощью модели `ProductModel`:
  - Устанавливает флаг загрузки (`loading`) в `true`.
  - Обновляет каталог продуктов в состоянии после успешной загрузки.
  - Генерирует ошибку, если произошла ошибка при загрузке (уже обработана в `ProductModel`).
  - Сбрасывает флаг загрузки после завершения операции.
- `addToBasket(productId: string): void` Добавляет продукт в корзину по его ID, если он еще не добавлен. После добавления генерируется событие `basket:updated`.
- `removeFromBasket(productId: string): void` Удаляет продукт из корзины по его ID. После удаления генерируется событие `basket:updated`.
- `clearBasket(): void` Очищает корзину, обновляет счетчик корзины и генерирует событие `basket:updated`.
- `setPreview(productId: string | null): void` Устанавливает ID продукта для предпросмотра. Если передано значение `null`, предпросмотр очищается. Генерируется событие `preview:changed`.
- `getBasketItems(): IBasketItem[]` Возвращает массив элементов корзины, содержащий информацию о добавленных продуктах (ID, название, цена, количество).
- `calculateBasketTotal(): number` Вычисляет общую стоимость товаров в корзине на основе их цен из каталога.
- `async placeOrder(orderData: IOrder): Promise<void>` Размещает заказ:
  - Устанавливает флаг загрузки (`loading`) в `true`.
  - Проверяет валидность данных заказа с помощью модели `OrderModel`.
  - Если валидация пройдена, отправляет заказ на сервер и обновляет состояние заказа.
  - Очищает корзину после успешного размещения заказа.
  - Генерирует событие `order:placed` или `order:error` в зависимости от результата.
- `updateBasketCounter(): void` Обновляет счетчик количества товаров в корзине и генерирует событие `basket:counter`.
- `setPaymentMethod(method: 'online' | 'cash'): void` Устанавливает выбранный способ оплаты (например, "online" или "cash") и генерирует событие `payment:method`.
- `getPaymentMethod(): 'online' | 'cash' | null` Возвращает выбранный способ оплаты или `null`, если способ оплаты не выбран.

#### Типы, связанные с классом

- `IAppState` Интерфейс описывает состояние приложения. Содержит следующие поля:
  - `catalog: IProduct[]` — массив продуктов в каталоге.
  - `basket: string[]` — массив ID продуктов, добавленных в корзину.
  - `preview: string | null` — ID продукта, который отображается в предпросмотре.
  - `order: IOrder | null` — данные текущего заказа.
  - `loading: boolean` — флаг загрузки данных.
  - `paymentMethod: 'online' | 'cash' | null` — выбранный способ оплаты.
- `IProduct` Интерфейс описывает структуру продукта. Содержит следующие поля:
  - `id: string` — уникальный идентификатор продукта.
  - `title: string` — название продукта.
  - `description: string` — описание продукта.
  - `image: string` — путь к изображению продукта.
  - `category: string` — категория продукта.
  - `price: number | null` — цена продукта.
- `IOrder` Интерфейс описывает структуру заказа. Содержит следующие поля:
  - `payment: string` — способ оплаты.
  - `email: string` — электронная почта пользователя.
  - `phone: string` — телефон пользователя.
  - `address: string` — адрес доставки.
  - `total: number` — общая стоимость заказа.
  - `items: string[]` — массив ID продуктов в заказе.
- `IBasketItem` Интерфейс описывает элемент корзины. Содержит следующие поля:
  - `id: string` — уникальный идентификатор продукта.
  - `title: string` — название продукта.
  - `price: number | null` — цена продукта.
  - `quantity: number` — количество единиц продукта.
- `IEvents` Интерфейс, описывающий систему событий. Предоставляет методы для подписки на события (`on`), генерации событий (`emit`) и создания триггеров (`trigger`).

Класс `AppState` предоставляет удобный и централизованный способ управления состоянием приложения. Его методы позволяют легко работать с каталогом продуктов, корзиной, заказами и другими аспектами состояния, а также взаимодействовать с другими компонентами через систему событий. Наследование от `Model<IAppState>` делает его расширяемым и совместимым с общей архитектурой приложения.

### 3. Класс `Order`

Класс `Order` представляет собой модель для управления данными заказа пользователя. Он отвечает за хранение информации о заказе и предоставляет методы для валидации данных и отправки заказа.

`constructor(payment: string, email: string, phone: string, address: string, total: number, items: string[])` Конструктор принимает параметры, необходимые для инициализации данных заказа, такие как способ оплаты, контактная информация, адрес доставки, общая сумма и список товаров. Эти параметры используются для заполнения соответствующих полей класса.

#### Поля класса

- `payment: string` Хранит способ оплаты, выбранный пользователем (например, "Наличные", "Карта").
- `email: string` Хранит электронную почту пользователя, используемую для уведомлений.
- `phone: string` Хранит номер телефона пользователя, используемый для связи.
- `address: string` Хранит адрес доставки, по которому будет доставлен заказ.
- `total: number` Хранит общую сумму заказа, рассчитанную на основе стоимости всех товаров.
- `items: string[]` Хранит массив идентификаторов товаров, добавленных в заказ.

#### Методы класса

- `submit(): void` Отправляет данные заказа на сервер или в обработчик. Метод выполняет следующие действия:
  - Вызывает метод `validate()` для проверки корректности данных.
  - Если данные валидны, выводит их в консоль.
  - Если данные невалидны, выводится сообщение об ошибке через `console.error`.
- `validate(): boolean` Проверяет корректность данных заказа. Метод выполняет следующие проверки:
  - Все обязательные поля (например, `payment`, `email`, `phone`, `address`) заполнены.
  - Формат email соответствует стандарту (например, содержит символ `@` и домен). Для проверки используется регулярное выражение: `/^[^\s@]+@[^\s@]+\.[^\s@]+$/`.
  - Формат номера телефона соответствует требованиям (например, содержит только цифры и имеет длину от 7 до 15 символов). Для проверки используется регулярное выражение: `/^[0-9]{7,15}$/`.
  - Общая сумма (`total`) больше нуля.
  - Массив товаров (`items`) не пустой.
  - Возвращает `true`, если все проверки пройдены, и `false` в противном случае.

Класс `Order` предоставляет удобный способ управления данными заказа. Его конструктор инициализирует все необходимые поля, а методы позволяют проверять корректность данных перед отправкой и управлять процессом оформления заказа. Этот класс является важной частью бизнес-логики приложения, гарантируя, что отправляемые данные соответствуют требованиям и готовы к дальнейшей обработке.

## View

### 1. Класс `Form<T>`

Класс `Form<T>` представляет собой универсальный компонент для работы с формами в пользовательском интерфейсе. Он наследуется от базового класса `Component<IFormState>` и предоставляет инструментарий для управления состоянием формы, обработки ввода данных, проверки их корректности и отображения ошибок. Этот класс интегрируется с системой событий через `IEvents`, что позволяет уведомлять другие части приложения о действиях пользователя.

`constructor(protected container: HTMLFormElement, protected events: IEvents)` Конструктор принимает HTML-форму (`container`) и экземпляр системы событий (`events`). Внутри конструктора инициализируются элементы интерфейса (кнопка отправки `submitButtonElement` и блок ошибок `errorsElement`), а также настраиваются обработчики событий для отслеживания изменений в полях формы и отправки данных. При изменении значения в полях формы генерируется событие `${this.container.name}.${field}:change`. При отправке формы генерируется событие `${this.container.name}:submit`.

#### Поля класса

- `submitButtonElement: HTMLButtonElement` Хранит ссылку на кнопку отправки формы. Используется для управления состоянием кнопки (например, блокировка при недопустимых данных).
- `errorsElement: HTMLElement` Хранит ссылку на элемент, отображающий сообщения об ошибках. Используется для вывода информации о неправильно заполненных полях.
- `_valid: boolean` Приватное поле, хранящее текущее состояние валидности формы. По умолчанию установлено значение `false`.

#### Методы класса

- `onInputChange(field: keyof T, value: string): void` Вызывается при изменении значения в поле формы. Генерирует событие `${this.container.name}.${String(field)}:change`, уведомляющее систему о том, что значение поля изменилось. Событие содержит имя поля (`field`) и новое значение (`value`).
- `set valid(value: boolean): void` Управляет состоянием кнопки отправки формы. Если значение `true`, кнопка становится активной; если `false`, кнопка блокируется.
- `get valid(): boolean` Возвращает текущее состояние валидности формы (`_valid`).
- `set errors(value: string): void` Устанавливает текстовое содержимое блока ошибок. Если ошибок нет, блок может быть очищен.
- `render(state: Partial<T> & IFormState): HTMLElement` Применяет переданное состояние к форме. Метод разделяет состояние на данные формы (`inputs`) и метаданные (`valid`, `errors`). Обновляет внутреннее состояние формы. После рендеринга возвращает корневой DOM-элемент формы.

#### Типы, связанные с классом

- `IFormState` Интерфейс описывает состояние формы. Содержит два поля:
  - `valid: boolean` — флаг, указывающий, является ли форма допустимой для отправки.
  - `errors: string[]` — массив сообщений об ошибках.
- `IEvents` Интерфейс, описывающий систему событий. Предоставляет методы для подписки на события (`on`), генерации событий (`emit`) и создания триггеров (`trigger`).

Класс `Form<T>` предоставляет мощный и гибкий инструментарий для работы с формами. Его методы позволяют легко управлять состоянием формы, обрабатывать пользовательский ввод и взаимодействовать с другими компонентами через систему событий. Наследование от `Component<IFormState>` делает его расширяемым и совместимым с общей архитектурой приложения.

### 2. Класс `Modal`

Класс `Modal` представляет собой компонент для управления модальными окнами в пользовательском интерфейсе. Он наследуется от базового класса `Component<IModalData>` и предоставляет инструментарий для отображения, скрытия и управления содержимым модального окна. Этот класс интегрируется с системой событий через `IEvents`, что позволяет уведомлять другие части приложения о действиях пользователя.

`constructor(container: HTMLElement, protected events: IEvents)` Конструктор принимает корневой DOM-элемент модального окна (`container`) и экземпляр системы событий (`events`). Внутри конструктора инициализируются элементы интерфейса (кнопка закрытия `closeButtonElement` и контейнер для содержимого `contentElement`), а также настраиваются обработчики событий для закрытия модального окна с помощью метода `close()`.

#### Поля класса

- `closeButtonElement: HTMLButtonElement` Хранит ссылку на кнопку закрытия модального окна. Используется для закрытия окна при клике на кнопку.
- `contentElement: HTMLElement` Хранит ссылку на контейнер для содержимого модального окна. Используется для управления отображаемым содержимым.

#### Методы класса

- `set content(value: HTMLElement | DocumentFragment): void` Устанавливает содержимое модального окна:
  - Очищает текущее содержимое контейнера.
  - Если передан `DocumentFragment`, добавляет его первый дочерний элемент в контейнер.
  - Если передан `HTMLElement`, добавляет его напрямую в контейнер.
- `open(): void` Открывает модальное окно, добавляя класс `modal_active` к корневому элементу. Также генерируется событие `modal:open`.
- `close(): void` Закрывает модальное окно, удаляя класс `modal_active` из корневого элемента. Содержимое контейнера очищается, и генерируется событие `modal:close`.
- `render(data: IModalData): HTMLElement` Применяет переданные данные к модальному окну:
  - Устанавливает содержимое окна, если передано значение `data.content`.
  - Вызывает метод `open()` для отображения окна.
  - Возвращает корневой DOM-элемент модального окна.
- `isActive(): boolean` Проверяет, активно ли модальное окно (содержит ли корневой элемент класс `modal_active`).
- `getButton(): HTMLElement | null` Возвращает кнопку внутри содержимого модального окна, если она существует. Поиск выполняется по селектору `.card__button`.
- `getContent(): HTMLElement` Возвращает контейнер для содержимого модального окна (`contentElement`).

#### Типы, связанные с классом

- `IModalData` Интерфейс описывает данные, которые могут быть переданы в модальное окно. Содержит одно поле:
  - `content: HTMLElement` — элемент, который будет отображен в качестве содержимого модального окна.
- `IEvents` Интерфейс, описывающий систему событий. Предоставляет методы для подписки на события (`on`), генерации событий (`emit`) и создания триггеров (`trigger`).

Класс `Modal` предоставляет удобный и универсальный способ управления модальными окнами. Его методы позволяют легко открывать, закрывать и обновлять содержимое окна, а также взаимодействовать с другими компонентами через систему событий. Наследование от `Component<IModalData>` делает его расширяемым и совместимым с общей архитектурой приложения.

### 3. Класс `Success`

Класс `Success` представляет собой компонент для отображения успешного завершения действия, например, оформления заказа. Он наследуется от базового класса `Component<ISuccess>` и предоставляет инструментарий для управления состоянием успеха, включая отображение общей суммы и обработку действий пользователя. Этот класс поддерживает взаимодействие через коллбэки, что делает его гибким для интеграции с другими частями приложения.

`constructor(container: HTMLElement, actions: ISuccessActions)` Конструктор принимает корневой DOM-элемент (`container`) и объект действий (`actions`). Внутри конструктора инициализируются элементы интерфейса (кнопка закрытия `closeElement` и блок описания `descriptionElement`), а также настраивается обработчик событий для кнопки закрытия, если передан коллбэк `onClick` в объекте `actions`.

#### Поля класса

- `closeElement: HTMLElement` Хранит ссылку на элемент, который используется для закрытия или выполнения действия в компоненте. Например, это может быть кнопка "Закрыть" или "Продолжить".
- `descriptionElement: HTMLElement` Хранит ссылку на элемент, отображающий описание успешного действия (например, сумму списания).

#### Методы класса

- `render(data: ISuccess): HTMLElement` Применяет переданные данные к компоненту:
  - Устанавливает текстовое содержимое блока описания, форматируя общую сумму с помощью функции `formatNumber`.
  - Возвращает корневой DOM-элемент компонента.

#### Типы, связанные с классом

- `ISuccess` Интерфейс описывает данные, которые могут быть переданы в компонент. Содержит одно поле:
  - `total: number` — общая сумма, связанная с успешным действием (например, стоимость заказа).
- `ISuccessActions` Интерфейс описывает действия, которые могут быть выполнены в компоненте. Содержит одно поле:
  - `onClick: () => void` — коллбэк, вызываемый при клике на элемент закрытия или действия.

Класс `Success` предоставляет простой и эффективный способ отображения успешного завершения действия. Его интеграция с коллбэками (`ISuccessActions`) позволяет легко настраивать поведение компонента в зависимости от требований приложения. Наследование от `Component<ISuccess>` делает его расширяемым и совместимым с общей архитектурой приложения.

### 4. Класс `Card`

Класс `Card` представляет собой компонент для отображения информации о продукте в пользовательском интерфейсе. Он наследуется от базового класса `Component<IProduct>` и предоставляет инструментарий для рендеринга данных о продукте, обработки кликов по карточке и взаимодействия с системой событий через `IEvents`.

`constructor(container: HTMLElement, events: IEvents)` Конструктор принимает корневой DOM-элемент (`container`) и экземпляр системы событий (`events`). Внутри конструктора:

- Инициализируется базовый класс `Component<IProduct>`.
- Настраивается обработчик события клика на карточке:
  - При клике генерируется событие `product:selected` с ID продукта, если он установлен.

#### Поля класса

- `events: IEvents` Хранит ссылку на объект системы событий, который используется для генерации событий при взаимодействии с карточкой.
- `productId: string | null` Хранит уникальный идентификатор продукта, связанный с текущей карточкой. Если продукт не установлен, значение равно `null`.
- `product: IProduct | null` Хранит данные о продукте, связанные с текущей карточкой. Если продукт не установлен, значение равно `null`.

#### Методы класса

- `getProduct(): IProduct | null` Возвращает данные о продукте, связанные с текущей карточкой. Если продукт не установлен, возвращается `null`.
- `render(product: IProduct): HTMLElement` Рендерит данные о продукте в карточку:
  - Обновляет внутренние поля `product` и `productId` на основе переданных данных.
  - Заполняет элементы интерфейса (категория, название, цена, изображение) данными о продукте.
  - Возвращает корневой DOM-элемент карточки после рендеринга.

#### Типы, связанные с классом

- `IProduct` Интерфейс описывает структуру продукта. Содержит следующие поля:
  - `id: string` — уникальный идентификатор продукта.
  - `title: string` — название продукта.
  - `category: string` — категория продукта.
  - `price: number | null` — цена продукта (может быть `null`, если цена не указана).
  - `image: string` — путь к изображению продукта.
- `IEvents` Интерфейс, описывающий систему событий. Предоставляет методы для подписки на события (`on`), генерации событий (`emit`) и создания триггеров (`trigger`).

Класс `Card` предоставляет удобный способ отображения данных о продукте и управления взаимодействием с карточкой. Его методы позволяют легко рендерить информацию о продукте и уведомлять другие части приложения о действиях пользователя через систему событий. Наследование от `Component<IProduct>` делает его расширяемым и совместимым с общей архитектурой приложения.

### 5. Класс `CardList`

Класс `CardList` представляет собой компонент для управления списком карточек продуктов в пользовательском интерфейсе. Он наследуется от базового класса `Component<IProductList>` и предоставляет инструментарий для рендеринга списка карточек, поиска карточек по ID продукта и взаимодействия с системой событий через `IEvents`.

`constructor(container: HTMLElement, events: IEvents)` Конструктор принимает корневой DOM-элемент (`container`) и экземпляр системы событий (`events`). Внутри конструктора:

- Инициализируется базовый класс `Component<IProductList>`.
- Сохраняется ссылка на объект системы событий для использования в дочерних компонентах.

#### Поля класса

- `items: Card[]` Хранит массив экземпляров класса `Card`, представляющих карточки продуктов в списке.
- `events: IEvents` Хранит ссылку на объект системы событий, который используется для передачи событий в дочерние компоненты (например, карточки).

#### Методы класса

- `getCards(): Card[]` Возвращает массив всех карточек (`Card`), содержащихся в списке.
- `getCardById(productId: string): Card | undefined` Находит карточку по ID продукта:
  - Возвращает экземпляр класса `Card`, если карточка найдена.
  - Если карточка с указанным ID не найдена, возвращается `undefined`.
- `render(data?: Partial<IProductList>): HTMLElement` Рендерит список карточек на основе переданных данных:
  - Очищает текущий контейнер с помощью метода `replaceChildren`.
  - Создает новые карточки для каждого продукта из массива `items`:
    - Использует шаблон (`card-catalog`) для создания DOM-элементов карточек.
    - Инициализирует экземпляры класса `Card` и рендерит данные о продукте.
  - Добавляет созданные карточки в контейнер.
  - Возвращает корневой DOM-элемент контейнера после рендеринга.

#### Типы, связанные с классом

- `IProductList` Интерфейс описывает структуру данных для списка продуктов. Содержит следующие поля:
  - `total: number` — общее количество продуктов в списке.
  - `items: IProduct[]` — массив продуктов, которые нужно отобразить.
- `IProduct` Интерфейс описывает структуру продукта. Содержит следующие поля:
  - `id: string` — уникальный идентификатор продукта.
  - `title: string` — название продукта.
  - `category: string` — категория продукта.
  - `price: number | null` — цена продукта (может быть `null`, если цена не указана).
  - `image: string` — путь к изображению продукта.
- `IEvents` Интерфейс, описывающий систему событий. Предоставляет методы для подписки на события (`on`), генерации событий (`emit`) и создания триггеров (`trigger`).

Класс `CardList` предоставляет удобный способ управления списком карточек продуктов. Его методы позволяют легко рендерить карточки, находить их по ID и взаимодействовать с другими частями приложения через систему событий. Наследование от `Component<IProductList>` делает его расширяемым и совместимым с общей архитектурой приложения.

### 6. Класс `Contacts`

Класс `Contacts` предназначен для работы с контактными данными пользователя в пользовательском интерфейсе. Он отвечает за валидацию введенных данных и отправку их на сервер или в обработчик.

`constructor(email: string, phone: string)` Конструктор принимает данные о контактах пользователя, такие как электронная почта (`email`) и номер телефона (`phone`). Эти данные используются для инициализации полей класса.

#### Поля класса

- `email: string` Хранит строку, содержащую электронную почту пользователя. Предназначен для хранения `email`, который может быть изменен или отправлен на сервер.
- `phone: string` Хранит строку, содержащую номер телефона пользователя. Предназначен для хранения номера телефона, который может быть изменен или отправлен на сервер.

#### Методы класса

- `submit(): void` Отправляет контактные данные (`email` и `phone`) на сервер или в обработчик. Вызывает метод `validate()` для проверки корректности данных. Если данные валидны, отправляет их на сервер или вызывает соответствующий обработчик (например, через событие). Если данные не валидны, выводит сообщение об ошибке или уведомляет пользователя о необходимости исправить данные.
- `validate(): boolean` Проверяет корректность контактных данных (`email` и `phone`). Проверяет, соответствует ли `email` формату электронной почты (например, содержит символ `@` и домен). Проверяет, соответствует ли номер телефона определенному формату (например, содержит только цифры и имеет допустимую длину). Возвращает результат проверки: `boolean — true`, если данные валидны; `false`, если данные невалидны.

Класс `Contacts` предоставляет удобный способ управления контактными данными пользователя. Он содержит поля для хранения `email` и номера телефона, а также методы для их валидации и отправки. Этот класс является важной частью пользовательского интерфейса, так как обеспечивает корректное взаимодействие с формой контактов и гарантирует, что отправляемые данные соответствуют требованиям.

### 7. Класс `Header`

Класс `Header` предназначен для управления шапкой страницы в пользовательском интерфейсе. Он отвечает за отображение логотипа, кнопки корзины и обновление информации о корзине (например, общая сумма товаров).

`constructor(container: HTMLElement)` Конструктор принимает HTML-элемент (`container`), который представляет контейнер шапки. Этот элемент используется для привязки шапки к конкретному месту на странице.

#### Поля класса

- `_logo: HTMLElement` Хранит ссылку на HTML-элемент, представляющий логотип. Предназначен для отображения логотипа в шапке.
- `_basketButton: HTMLElement` Хранит ссылку на HTML-элемент, представляющий кнопку корзины. Предназначен для отображения информации о корзине (например, общая сумма товаров).

#### Методы класса

- `updateBasket(total: number): void` Обновляет информацию о корзине (например, отображает общую сумму товаров). Обновляет текстовое содержимое кнопки корзины (`_basketButton`) с новой информацией о сумме. Если сумма равна `0`, может скрывать или изменять внешний вид кнопки (например, показывать "Корзина пуста").

Класс `Header` предоставляет удобный способ управления шапкой страницы. Он содержит поля для хранения ключевых элементов шапки (логотип и кнопка корзины), а также метод для обновления информации о корзине. Этот класс является важной частью пользовательского интерфейса, так как обеспечивает отображение и обновление данных в реальном времени.

## Presenter

### 3. Класс `Page`

Класс `Page` является координатором между всеми компонентами страницы (например, шапкой, корзиной, списком карточек товаров, модальным окном). Он отвечает за инициализацию этих компонентов, их настройку и обработку событий, которые происходят между ними.

`constructor(header: Header, basket: Basket, cardList: CardList, modal: Modal)` Конструктор принимает экземпляры компонентов страницы: шапку (`Header`), корзину (`Basket`), список карточек товаров (`CardList`) и модальное окно (`Modal`). Эти компоненты используются для управления соответствующими частями интерфейса.

#### Поля класса

- `_header: Header` Хранит ссылку на экземпляр класса `Header`. Предназначен для управления логотипом и кнопкой корзины.
- `_basket: Basket` Хранит ссылку на экземпляр класса `Basket`. Предназначен для управления содержимым корзины и взаимодействия с пользователем.
- `_cardList: CardList` Хранит ссылку на экземпляр класса `CardList`. Предназначен для управления отображением и добавлением товаров.
- `_modal: Modal` Хранит ссылку на экземпляр класса `Modal`. Предназначен для управления отображением и содержимым модального окна.

#### Методы класса

- `initHeader(): void` Инициализирует шапку страницы. Выполняет настройку шапки (например, обновление информации о корзине). Подписывается на события, связанные с шапкой (например, клик по кнопке корзины).
- `initBasket(): void` Инициализирует корзину. Выполняет настройку корзины (например, загрузка данных о товарах из хранилища). Подписывается на события, связанные с корзиной (например, добавление или удаление товаров).
- `initCardList(): void` Инициализирует список карточек товаров. Выполняет настройку списка карточек (например, рендеринг товаров из API). Подписывается на события, связанные с карточками (например, клик по кнопке "Добавить в корзину").
- `initModal(): void` Инициализирует модальное окно. Выполняет настройку модального окна (например, отображение формы заказа). Подписывается на события, связанные с модальным окном (например, закрытие или отправка формы).
- `handleEvents(): void` Обрабатывает события между компонентами страницы. Координирует взаимодействие между компонентами (например, обновление корзины при добавлении товара из карточки). Обрабатывает глобальные события (например, открытие модального окна при клике на кнопку "Оформить заказ").

Класс `Page` является ключевым компонентом приложения, который координирует работу всех частей интерфейса. Он содержит поля для хранения ссылок на основные компоненты страницы (шапка, корзина, список карточек, модальное окно) и методы для их инициализации и обработки событий. Этот класс играет роль презентера в архитектуре MVP, обеспечивая согласованную работу между моделью и представлением.

## Основные типы данных и интерфейсы

```
export interface IProductList {
  total: number;        // Общее количество продуктов
  items: IProduct[];    // Массив продуктов
}

export interface IProduct {
  id: string;           // Уникальный идентификатор продукта
  description: string;  // Описание продукта
  image: string;        // Путь к изображению продукта
  title: string;        // Название продукта
  category: string;     // Категория продукта
  price: number | null; // Цена продукта (может быть null)
}

export interface IProductNotFound {
  error: string;        // Сообщение об ошибке ("NotFound")
}

export interface IOrder {
  payment: string;      // Способ оплаты ("online")
  email: string;        // Электронная почта
  phone: string;        // Телефон
  address: string;      // Адрес доставки
  total: number;        // Общая сумма заказа
  items: string[];      // Массив идентификаторов продуктов
}

export interface IOrderSuccess {
  id: string;           // Уникальный идентификатор заказа
  total: number;        // Общая сумма заказа
}

export interface IOrderError {
  error: string;        // Сообщение об ошибке
}
```
