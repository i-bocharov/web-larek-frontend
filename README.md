# Проектная работа "Веб-ларек"

Стек: HTML, SCSS, TS, Webpack

Структура проекта:

- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом

Важные файлы:

- src/pages/index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/index.ts — точка входа приложения
- src/scss/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Установка и запуск

Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

или

```
yarn
yarn start
```

## Сборка

```
npm run build
```

или

```
yarn build
```

## Архитектура

![UML-диаграмма](uml-diagramm.png)

## Базовый код

### 1. Класс `Api`

Класс `Api` предоставляет удобный интерфейс для выполнения HTTP-запросов к REST API. Он поддерживает настройку базового URL, заголовков и методов запроса, а также включает встроенную обработку ошибок.

#### Основные возможности

- Настройка базового URL: Упрощает работу с API, позволяя указать базовый URL один раз при создании экземпляра класса.
- Поддержка различных HTTP-методов: Реализованы методы для выполнения GET-запросов, а также POST, PUT и DELETE.
- Обработка ошибок: Встроенный механизм обработки ошибок позволяет получать информативные сообщения об ошибках из ответа сервера.
- Гибкая настройка заголовков: Возможность добавлять или переопределять заголовки запросов через конструктор.

#### Типы данных

`ApiListResponse<Type>`
Описывает структуру ответа от API для списков данных:

- `total`: Общее количество элементов.
- `items`: Массив элементов типа Type.

`ApiPostMethods`
Ограничивает допустимые HTTP-методы для POST-подобных запросов.

#### Конструктор

`constructor(baseUrl: string, options: RequestInit = {});`

##### Параметры:

- `baseUrl: string` — Базовый URL для всех запросов.
- `options: RequestInit` (опционально) — Дополнительные настройки для HTTP-запросов (например, заголовки). По умолчанию пустой объект.

##### Поля:

`readonly baseUrl: string`

Тип: `string` Модификатор доступа: `readonly`

###### Предназначение:

- Хранит базовый URL для всех HTTP-запросов.
- Используется для формирования полного пути к API путем конкатенации с относительным URI (например, `/users`).

`protected options: RequestInit`

Тип: `RequestInit` Модификатор доступа: `protected`

###### Предназначение:

- Содержит настройки для HTTP-запросов, такие как заголовки (`headers`), методы (`method`), тело запроса (`body`) и другие параметры.
- Эти настройки применяются ко всем запросам, выполняемым через экземпляр класса `Api`.
- Заголовок `'Content-Type': 'application/json'` устанавливается по умолчанию, но может быть переопределен или дополнен через конструктор.

##### Методы:

Класс имеет методы $${\color{green}\Large{}\textbf{get}}$$ для получения данных от сервера с помощью GET запросов, $${\color{green}\Large{}\textbf{post}}$$ для отправки на сервер POST, PUT и DELETE запросов и $${\color{green}\Large{}\textbf{handleResponse}}$$ для обработки ошибок.

### 2. Класс `Component<T>`

Класс `Component<T>` представляет собой абстрактный базовый класс для создания компонентов пользовательского интерфейса. Он предоставляет инструментарий для работы с DOM-элементами, такими как управление классами, текстовым содержимым, состоянием блокировки, видимостью, изображениями и т.д. Этот класс является универсальным и может быть расширен для создания специализированных компонентов.

#### Зона ответственности:

- Управление базовыми операциями с DOM-элементами.
- Предоставление методов для манипуляции стилями, атрибутами и содержимым элементов.
- Поддержка рендеринга компонента с передачей данных.

#### Конструктор

`protected constructor(protected readonly container: HTMLElement)`

Конструктор принимает корневой DOM-элемент (`container`) и сохраняет его в защищенном поле `container`. Этот элемент будет использоваться всеми методами класса для выполнения операций с DOM.

##### Параметры:

`container: HTMLElement` — корневой DOM-элемент, который будет использоваться как контейнер для компонента. Этот элемент является основным местом, где будут происходить все манипуляции.

##### Поля класса

`protected readonly container: HTMLElement`

- Назначение: Хранит ссылку на корневой DOM-элемент, который является контейнером для компонента.
- Данные: Экземпляр `HTMLElement`, переданный через конструктор.

##### Методы класса

$${\color{green}\Large{}\textbf{toggleClass}}$$ Переключает указанный класс для элемента. Если параметр `force` не передан, класс будет добавлен, если его нет, и удален, если он уже существует.

Параметры:

- `element: HTMLElement` — элемент, для которого нужно переключить класс.
- `className: string` — имя класса, которое нужно добавить или удалить.
- `force: boolean | undefined` (опционально) — если указано, то класс будет добавлен (`true`) или удален (`false`), независимо от текущего состояния.

Возвращаемое значение: (`void`).

$${\color{green}\Large{}\textbf{setText}}$$ Устанавливает текстовое содержимое элемента. Если `value` равно `null` или `undefined`, оно будет преобразовано в пустую строку.

Параметры:

- `element: HTMLElement` — элемент, для которого нужно установить текстовое содержимое.
- `value: unknown` — значение, которое нужно преобразовать в строку и установить как текстовое содержимое элемента.

Возвращаемое значение: (`void`).

$${\color{green}\Large{}\textbf{setDisabled}}$$ Блокирует или разблокирует элемент, добавляя или удаляя атрибут `disabled`.

Параметры:

- `element: HTMLElement` — элемент, для которого нужно изменить состояние блокировки.
- `state: boolean` — новое состояние блокировки (`true` — заблокировать, `false` — разблокировать).

Возвращаемое значение: (`void`).

$${\color{green}\Large{}\textbf{setHidden}}$$ Скрывает элемент, устанавливая его стиль `display` в значение `none`.

Параметры:

- `element: HTMLElement` — элемент, который нужно скрыть.

Возвращаемое значение: (`void`).

$${\color{green}\Large{}\textbf{setVisible}}$$ Показывает элемент, удаляя свойство `display` из его стилей.

Параметры:

- `element: HTMLElement` — элемент, который нужно показать.

Возвращаемое значение: (`void`).

$${\color{green}\Large{}\textbf{setImage}}$$ Устанавливает атрибут `src` для изображения и, при необходимости, альтернативный текст (`alt`).

Параметры:

- `element: HTMLImageElement` — элемент изображения, для которого нужно установить источник и альтернативный текст.
- `src: string` — URL изображения.
- `alt: string | undefined` (опционально) — альтернативный текст для изображения.

Возвращаемое значение: (`void`).

$${\color{green}\Large{}\textbf{render}}$$ Применяет переданные данные к текущему экземпляру компонента (если они есть) и возвращает корневой DOM-элемент. Используется для рендеринга компонента.

Параметры:

- `data: Partial<T> | undefined` — частичные данные, которые нужно применить к компоненту.

Возвращаемое значение: `HTMLElement` — корневой DOM-элемент компонента.

Класс `Component<T>` предоставляет мощный и гибкий инструментарий для создания UI-компонентов. Его методы позволяют легко манипулировать DOM-элементами, а абстрактная природа класса делает его удобным для расширения в дочерних классах.

### 3. Класс `EventEmitter`

Реализует паттерн «Наблюдатель» и позволяет подписываться на события и уведомлять подписчиков
о наступлении события.

Класс имеет методы $${\color{green}\Large{}\textbf{on}}$$, $${\color{green}\Large{}\textbf{off}}$$, $${\color{green}\Large{}\textbf{emit}}$$ — для подписки на событие, отписки от события и уведомления
подписчиков о наступлении события соответственно.

Дополнительно реализованы методы $${\color{green}\Large{}\textbf{onAll}}$$ и $${\color{green}\Large{}\textbf{offAll}}$$ — для подписки на все события и сброса всех
подписчиков.

Интересным дополнением является метод $${\color{green}\Large{}\textbf{trigger}}$$, генерирующий заданное событие с заданными
аргументами. Это позволяет передавать его в качестве обработчика события в другие классы. Эти
классы будут генерировать события, не будучи при этом напрямую зависимыми от класса EventEmitter.

### 4. Класс `Model<T>`

Класс `Model<T>` представляет собой базовую модель, которая используется для работы с данными в приложении. Его основная задача — предоставить структуру для хранения данных, а также механизм для уведомления других частей приложения об изменениях в модели (паттерн "Наблюдатель"). Этот класс служит абстрактным базовым классом, который можно расширять для создания конкретных моделей с определённой структурой данных.

#### Конструктор:

`constructor(data: Partial<T>, protected events: IEvents)`

Конструктор принимает данные и объект событий, затем использует `Object.assign` для копирования переданных данных в текущий экземпляр модели. Это позволяет динамически создавать свойства модели на основе входных данных.

Параметры:

- `data: Partial<T>` — частичный объект данных, который будет использоваться для инициализации модели. Это позволяет передавать только те поля, которые необходимы, а остальные будут проинициализированы как `undefined`.
- `events: IEvents` — экземпляр интерфейса `IEvents`, который отвечает за управление событиями. Используется для уведомления подписчиков об изменениях в модели.

##### Поля класса:

`protected events: IEvents`

Назначение: Хранит ссылку на объект событий, который используется для генерации уведомлений об изменениях в модели. Это поле защищено (protected), чтобы оно могло быть доступно только внутри класса и его потомков.

`Динамические поля (из data)`

Назначение: Эти поля создаются динамически на основе переданных данных в конструкторе. Они представляют собой состояние модели и могут содержать любые данные, соответствующие типу T.

##### Методы класса:

$${\color{green}\Large{}\textbf{emitChanges}}$$ Используется для уведомления всех подписчиков о том, что модель изменилась. Он вызывает метод `emit` у объекта `events`, передавая название события и данные. Это позволяет другим частям приложения реагировать на изменения в модели.

Параметры:

- `event: string` — название события, которое будет отправлено подписчикам.
- `payload?: object` — дополнительные данные, которые могут быть переданы вместе с событием. Если параметр не указан, используется пустой объект `{}`.

Возвращаемое значение: `void`

## Model

### 1. Класс `Basket`

Класс `Basket` представляет собой компонент корзины покупок. Он отвечает за отображение списка товаров в корзине, обновление общей стоимости товаров и управление состоянием кнопки оформления заказа.

#### Зона ответственности:

- Отображение списка товаров в корзине.
- Обновление общей стоимости товаров.
- Управление состоянием кнопки оформления заказа (активна/неактивна).
- Генерация событий для взаимодействия с другими компонентами (например, открытие формы заказа).

#### Конструктор:

`constructor(container: HTMLElement, protected events: EventEmitter)`

##### Параметры конструктора:

`container: HTMLElement`
Представляет контейнер, в котором будет отображаться корзина.
Используется для поиска внутренних элементов корзины (список товаров, поле общей стоимости, кнопка).

`events: EventEmitter`
Экземпляр класса `EventEmitter`, который используется для генерации событий (например, открытие формы заказа при клике на кнопку).

##### Логика работы:

Выполняет инициализацию внутренних элементов корзины (`_list`, `_total`, `_button`).
Добавляет обработчик события клика на кнопку оформления заказа, который генерирует событие `order:open`.
Инициализирует список товаров как пустой массив.

##### Поля класса:

`_list: HTMLElement`

- Хранит ссылку на элемент, представляющий список товаров в корзине.
- Используется для добавления или удаления элементов из списка.

`_total: HTMLElement | null`

- Хранит ссылку на элемент, отображающий общую стоимость товаров.
- Если элемент не найден, значение будет `null`.

`_button: HTMLElement | null`

- Хранит ссылку на кнопку оформления заказа.
- Если кнопка не найдена, значение будет `null`.

`items: HTMLElement[] (set)`

- Принимает массив элементов, представляющих товары в корзине.
- Если массив пуст, отображается сообщение "Корзина пуста".

`selected: string[] (set)`

- Принимает массив идентификаторов выбранных товаров.
- Управляет состоянием кнопки оформления заказа (активна, если есть выбранные товары).

`total: number (set)`

- Принимает числовое значение общей стоимости товаров.
- Отображает форматированное значение в элементе `_total`.

##### Методы класса:

1. `set items` Обновляет отображение списка товаров в корзине.

Параметры:
`items: HTMLElement[]` — массив элементов, представляющих товары в корзине.

Логика работы:
Если массив содержит элементы, они заменяют содержимое списка `_list`.
Если массив пуст, в списке отображается сообщение "Корзина пуста".

2. `set selected` Управляет состоянием кнопки оформления заказа на основе выбранных товаров.

Параметры:
`items: string[]` — массив идентификаторов выбранных товаров.

Логика работы:
Если массив содержит хотя бы один элемент, кнопка оформления заказа становится активной.
Если массив пуст, кнопка становится неактивной.

3. `set total` Обновляет отображение общей стоимости товаров в корзине.

Параметры:
`total: number` — числовое значение общей стоимости товаров.

Логика работы:
Форматирует значение с помощью функции `formatNumber` и устанавливает его в текстовое содержимое элемента `_total`.

Класс `Basket` инкапсулирует логику работы с корзиной покупок, обеспечивая удобное управление списком товаров, общей стоимостью и состоянием кнопки оформления заказа. Использование сеттеров позволяет легко обновлять состояние корзины извне, а генерация событий через `EventEmitter` обеспечивает взаимодействие с другими компонентами приложения.

## View

### 1. Класс `Form<T>`

Класс `Form<T>` представляет собой универсальный компонент для работы с формами. Он управляет состоянием полей формы, валидацией и отображением ошибок, а также генерирует события при изменении данных или отправке формы.

#### Зона ответственности:

- Управление состоянием полей формы (ввод данных, обновление значений).
- Валидация формы и управление состоянием кнопки отправки.
- Отображение ошибок валидации.
- Генерация событий для взаимодействия с другими компонентами (например, при изменении поля или отправке формы).

#### Конструктор:

`constructor(protected container: HTMLFormElement, protected events: IEvents)`

##### Параметры конструктора:

`container: HTMLFormElement`

- Представляет DOM-элемент формы, который будет управляться этим компонентом.
- Используется для поиска внутренних элементов (кнопка отправки, блок ошибок).

`events: IEvents`

- Экземпляр интерфейса `IEvents`, который используется для генерации событий (например, при изменении полей или отправке формы).

##### Логика работы:

- Инициализирует внутренние элементы формы (`_submit` — кнопка отправки, `_errors` — блок ошибок).
- Добавляет обработчик события `input` для отслеживания изменений в полях формы. При изменении значения поля вызывается метод `onInputChange`.
- Добавляет обработчик события `submit` для предотвращения стандартного поведения формы и генерации события отправки.

##### Поля класса:

`_submit: HTMLButtonElement`

- Хранит ссылку на кнопку отправки формы.
- Используется для управления состоянием кнопки (активна/неактивна).

`_errors: HTMLElement`

- Хранит ссылку на элемент, отображающий ошибки валидации.
- Используется для обновления текста ошибок.

`valid: boolean (set)`

- Принимает логическое значение, указывающее, является ли форма валидной.
- Управляет состоянием кнопки отправки (активна, если форма валидна).

`errors: string (set)`

- Принимает строку с текстом ошибок валидации.
- Отображает текст ошибок в элементе `_errors`.

##### Методы класса:

$${\color{green}\Large{}\textbf{onInputChange}}$$ Уведомляет другие компоненты об изменении значения поля формы.

Параметры:
`field: keyof T` — имя поля формы (ключ объекта типа T).
`value: string` — новое значение поля.

Логика работы:
Генерирует событие `${this.container.name}.${String(field)}:change` с данными о поле и его новом значении.

$${\color{green}\Large{}\textbf{set valid}}$$ Управляет состоянием кнопки отправки на основе валидности формы.

Параметры:
`value: boolean` — состояние валидности формы.

Логика работы:

- Если `value` равно `true`, кнопка отправки становится активной.
- Если `value` равно `false`, кнопка отправки становится неактивной.

$${\color{green}\Large{}\textbf{set errors}}$$ Отображает сообщения об ошибках валидации пользователю.

Параметры:
`value: string` — текст ошибок валидации.

Логика работы:
Устанавливает текст ошибок в элементе `_errors`.

$${\color{green}\Large{}\textbf{render}}$$ Обновляет состояние формы и отображение на основе переданных данных.

Параметры:
`state: Partial<T> & IFormState` — объект, содержащий текущее состояние формы:
`valid: boolean` — состояние валидности формы.
`errors: string[]` — массив ошибок валидации.
Остальные свойства соответствуют полям формы (тип T).

Логика работы:
Разделяет состояние на две части:
`valid` и `errors` передаются в базовый метод `super.render`.
Остальные свойства (поля формы) обновляются через `Object.assign`.

Возвращает обновленный DOM-элемент формы.

Класс `Form<T>` предоставляет универсальное решение для работы с формами, инкапсулируя логику управления состоянием полей, валидации и отображения ошибок. Использование генерации событий через `IEvents` позволяет легко интегрировать форму с другими компонентами приложения. Метод `render` обеспечивает удобное обновление состояния формы и ее отображения.

### 2. Класс `Modal`

Класс `Modal` представляет собой компонент для управления модальными окнами. Он отвечает за отображение, закрытие и обновление содержимого модального окна, а также генерирует события при открытии и закрытии.

#### Зона ответственности:

- Отображение и скрытие модального окна.
- Управление содержимым модального окна.
- Обработка событий кликов для закрытия модального окна (по кнопке закрытия или по фону).
- Генерация событий для взаимодействия с другими компонентами (например, уведомление о том, что модальное окно открыто или закрыто).

#### Коструктор:

`constructor(container: HTMLElement, protected events: IEvents)`

##### Параметры конструктора:

`container: HTMLElement`

- Представляет DOM-элемент контейнера модального окна.
- Используется для поиска внутренних элементов (кнопка закрытия, блок содержимого).

`events: IEvents`
Экземпляр интерфейса `IEvents`, который используется для генерации событий (например, при открытии или закрытии модального окна).

##### Логика работы:

- Инициализирует внутренние элементы модального окна (`_closeButton` — кнопка закрытия, `_content` — блок содержимого).

- Добавляет обработчики событий:
  - Клик на кнопку закрытия вызывает метод `close`.
  - Клик на фон модального окна вызывает метод `close`.
  - Клик внутри блока содержимого предотвращается с помощью `stopPropagation`.

##### Поля класса:

`_closeButton: HTMLButtonElement`

- Хранит ссылку на кнопку закрытия модального окна.
- Используется для добавления обработчика клика.

`_content: HTMLElement`

- Хранит ссылку на блок содержимого модального окна.
- Используется для обновления содержимого модального окна.

`content: HTMLElement (set)`

- Принимает новый элемент для отображения в качестве содержимого модального окна.
- Если передано значение `null`, очищает содержимое.

##### Методы класса:

$${\color{green}\Large{}\textbf{set content}}$$ Обновляет содержимое модального окна.

Параметры:
`value: HTMLElement` — элемент, который будет отображен в модальном окне.

Логика работы:

- Заменяет содержимое блока `_content` новым элементом.
- Если передано значение `null`, очищает содержимое.

$${\color{green}\Large{}\textbf{open}}$$ Открывает модальное окно и уведомляет другие компоненты о его открытии.

Логика работы:

- Добавляет класс `modal_active` к контейнеру модального окна, делая его видимым.
- Генерирует событие `modal:open`.

$${\color{green}\Large{}\textbf{close}}$$ Закрывает модальное окно и уведомляет другие компоненты о его закрытии.

Логика работы:

- Удаляет класс `modal_active` из контейнера модального окна, скрывая его.
- Очищает содержимое модального окна.
- Генерирует событие `modal:close`.

$${\color{green}\Large{}\textbf{render}}$$ Рендерит новое содержимое модального окна и открывает его. Возвращает обновленный DOM-элемент модального окна.

Параметры:
`data: IModalData` — объект, содержащий данные для отображения:
`content: HTMLElement` — элемент, который будет отображен в модальном окне.

Логика работы:

- Вызывает базовый метод `super.render(data)` для обновления состояния.
- Открывает модальное окно с помощью метода `open`.

Класс `Modal` предоставляет универсальное решение для управления модальными окнами. Он инкапсулирует логику отображения, скрытия и обновления содержимого, а также генерирует события для взаимодействия с другими компонентами приложения. Использование обработчиков событий и методов управления состоянием делает класс удобным для повторного использования в различных частях приложения.

### 3. Класс `Success`

Класс `Success` представляет собой компонент для отображения успешного завершения операции (например, успешной оплаты или выполнения заказа). Он управляет состоянием интерфейса успеха и предоставляет возможность настройки действий пользователя после завершения операции.

#### Зона ответственности:

- Отображение информации об успешном завершении операции.
- Обеспечение взаимодействия с пользователем через кнопку действия (например, "Закрыть" или "Вернуться").
- Управление событиями, связанными с действиями пользователя (например, клик по кнопке).

#### Конструктор:

`constructor(container: HTMLElement, actions: ISuccessActions)`

Параметры конструктора:

`container: HTMLElement`

- Представляет DOM-элемент контейнера, который будет использоваться для отображения компонента успеха.
- Используется для поиска внутренних элементов (например, кнопки действия).

`actions: ISuccessActions`
Объект, содержащий колбэк-функции для обработки действий пользователя:

- `onClick: () => void` — функция, вызываемая при клике на кнопку действия.

Логика работы:

- Инициализирует внутренний элемент `_close`, представляющий кнопку действия.
- Если передан колбэк `onClick`, добавляет обработчик события клика на кнопку действия.

##### Поля класса:

`_close: HTMLElement`
Хранит ссылку на кнопку действия (например, "Закрыть" или "Вернуться").
Используется для управления поведением кнопки и добавления обработчиков событий.

##### Методы класса:

Нет явно определенных методов в классе.

Класс `Success` предоставляет базовую структуру для отображения успешного завершения операции. Он инкапсулирует логику управления кнопкой действия и позволяет настраивать поведение пользователя через колбэк-функции. Хотя в текущей реализации функционал ограничен, класс легко расширяется для поддержки дополнительных возможностей, таких как отображение данных операции и управление состоянием интерфейса.

## Presenter

Код презентера не выделен в отдельный класс, а размещен в основном скрипте приложения.
