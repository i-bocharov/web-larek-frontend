# Проектная работа "Веб-ларек"

Стек: HTML, SCSS, TS, Webpack

Структура проекта:

- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом

Важные файлы:

- src/pages/index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/index.ts — точка входа приложения
- src/scss/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Установка и запуск

Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

или

```
yarn
yarn start
```

## Сборка

```
npm run build
```

или

```
yarn build
```

## Архитектура

![UML-диаграмма](uml-diagramm.png)

## Базовый код

### 1. Класс `Api`

Класс `Api` предоставляет удобный интерфейс для выполнения HTTP-запросов к REST API. Он поддерживает настройку базового URL, заголовков и методов запроса, а также включает встроенную обработку ошибок.

#### Основные возможности

- Настройка базового URL: Упрощает работу с API, позволяя указать базовый URL один раз при создании экземпляра класса.
- Поддержка различных HTTP-методов: Реализованы методы для выполнения GET-запросов, а также POST, PUT и DELETE.
- Обработка ошибок: Встроенный механизм обработки ошибок позволяет получать информативные сообщения об ошибках из ответа сервера.
- Гибкая настройка заголовков: Возможность добавлять или переопределять заголовки запросов через конструктор.

#### Типы данных

`ApiListResponse<Type>`
Описывает структуру ответа от API для списков данных:

- `total`: Общее количество элементов.
- `items`: Массив элементов типа Type.

`ApiPostMethods`
Ограничивает допустимые HTTP-методы для POST-подобных запросов.

#### Конструктор

`constructor(baseUrl: string, options: RequestInit = {});`

##### Параметры:

- `baseUrl: string` — Базовый URL для всех запросов.
- `options: RequestInit` (опционально) — Дополнительные настройки для HTTP-запросов (например, заголовки). По умолчанию пустой объект.

##### Поля:

`readonly baseUrl: string`

Тип: `string` Модификатор доступа: `readonly`

###### Предназначение:

- Хранит базовый URL для всех HTTP-запросов.
- Используется для формирования полного пути к API путем конкатенации с относительным URI (например, `/users`).

`protected options: RequestInit`

Тип: `RequestInit` Модификатор доступа: `protected`

###### Предназначение:

- Содержит настройки для HTTP-запросов, такие как заголовки (`headers`), методы (`method`), тело запроса (`body`) и другие параметры.
- Эти настройки применяются ко всем запросам, выполняемым через экземпляр класса `Api`.
- Заголовок `'Content-Type': 'application/json'` устанавливается по умолчанию, но может быть переопределен или дополнен через конструктор.

##### Методы:

Класс имеет методы $${\color{green}\Large{}\textbf{get}}$$ для получения данных от сервера с помощью GET запросов, $${\color{green}\Large{}\textbf{post}}$$ для отправки на сервер POST, PUT и DELETE запросов и $${\color{green}\Large{}\textbf{handleResponse}}$$ для обработки ошибок.

### 2. Класс `Component<T>`

Класс `Component<T>` представляет собой абстрактный базовый класс для создания компонентов пользовательского интерфейса. Он предоставляет инструментарий для работы с DOM-элементами, такими как управление классами, текстовым содержимым, состоянием блокировки, видимостью, изображениями и т.д. Этот класс является универсальным и может быть расширен для создания специализированных компонентов.

#### Зона ответственности:

- Управление базовыми операциями с DOM-элементами.
- Предоставление методов для манипуляции стилями, атрибутами и содержимым элементов.
- Поддержка рендеринга компонента с передачей данных.

#### Конструктор

`protected constructor(protected readonly container: HTMLElement)`

Конструктор принимает корневой DOM-элемент (`container`) и сохраняет его в защищенном поле `container`. Этот элемент будет использоваться всеми методами класса для выполнения операций с DOM.

##### Параметры:

`container: HTMLElement` — корневой DOM-элемент, который будет использоваться как контейнер для компонента. Этот элемент является основным местом, где будут происходить все манипуляции.

##### Поля класса

`protected readonly container: HTMLElement`

- Назначение: Хранит ссылку на корневой DOM-элемент, который является контейнером для компонента.
- Данные: Экземпляр `HTMLElement`, переданный через конструктор.

##### Методы класса

$${\color{green}\Large{}\textbf{toggleClass}}$$ Переключает указанный класс для элемента. Если параметр `force` не передан, класс будет добавлен, если его нет, и удален, если он уже существует.

Параметры:

- `element: HTMLElement` — элемент, для которого нужно переключить класс.
- `className: string` — имя класса, которое нужно добавить или удалить.
- `force: boolean | undefined` (опционально) — если указано, то класс будет добавлен (`true`) или удален (`false`), независимо от текущего состояния.

Возвращаемое значение: (`void`).

$${\color{green}\Large{}\textbf{setText}}$$ Устанавливает текстовое содержимое элемента. Если `value` равно `null` или `undefined`, оно будет преобразовано в пустую строку.

Параметры:

- `element: HTMLElement` — элемент, для которого нужно установить текстовое содержимое.
- `value: unknown` — значение, которое нужно преобразовать в строку и установить как текстовое содержимое элемента.

Возвращаемое значение: (`void`).

$${\color{green}\Large{}\textbf{setDisabled}}$$ Блокирует или разблокирует элемент, добавляя или удаляя атрибут `disabled`.

Параметры:

- `element: HTMLElement` — элемент, для которого нужно изменить состояние блокировки.
- `state: boolean` — новое состояние блокировки (`true` — заблокировать, `false` — разблокировать).

Возвращаемое значение: (`void`).

$${\color{green}\Large{}\textbf{setHidden}}$$ Скрывает элемент, устанавливая его стиль `display` в значение `none`.

Параметры:

- `element: HTMLElement` — элемент, который нужно скрыть.

Возвращаемое значение: (`void`).

$${\color{green}\Large{}\textbf{setVisible}}$$ Показывает элемент, удаляя свойство `display` из его стилей.

Параметры:

- `element: HTMLElement` — элемент, который нужно показать.

Возвращаемое значение: (`void`).

$${\color{green}\Large{}\textbf{setImage}}$$ Устанавливает атрибут `src` для изображения и, при необходимости, альтернативный текст (`alt`).

Параметры:

- `element: HTMLImageElement` — элемент изображения, для которого нужно установить источник и альтернативный текст.
- `src: string` — URL изображения.
- `alt: string | undefined` (опционально) — альтернативный текст для изображения.

Возвращаемое значение: (`void`).

$${\color{green}\Large{}\textbf{render}}$$ Применяет переданные данные к текущему экземпляру компонента (если они есть) и возвращает корневой DOM-элемент. Используется для рендеринга компонента.

Параметры:

- `data: Partial<T> | undefined` — частичные данные, которые нужно применить к компоненту.

Возвращаемое значение: `HTMLElement` — корневой DOM-элемент компонента.

Класс `Component<T>` предоставляет мощный и гибкий инструментарий для создания UI-компонентов. Его методы позволяют легко манипулировать DOM-элементами, а абстрактная природа класса делает его удобным для расширения в дочерних классах.

### 3. Класс `EventEmitter`

Реализует паттерн «Наблюдатель» и позволяет подписываться на события и уведомлять подписчиков
о наступлении события.

Класс имеет методы $${\color{green}\Large{}\textbf{on}}$$, $${\color{green}\Large{}\textbf{off}}$$, $${\color{green}\Large{}\textbf{emit}}$$ — для подписки на событие, отписки от события и уведомления
подписчиков о наступлении события соответственно.

Дополнительно реализованы методы $${\color{green}\Large{}\textbf{onAll}}$$ и $${\color{green}\Large{}\textbf{offAll}}$$ — для подписки на все события и сброса всех
подписчиков.

Интересным дополнением является метод $${\color{green}\Large{}\textbf{trigger}}$$, генерирующий заданное событие с заданными
аргументами. Это позволяет передавать его в качестве обработчика события в другие классы. Эти
классы будут генерировать события, не будучи при этом напрямую зависимыми от класса EventEmitter.

### 4. Класс `Model<T>`

Класс `Model<T>` представляет собой базовую модель, которая используется для работы с данными в приложении. Его основная задача — предоставить структуру для хранения данных, а также механизм для уведомления других частей приложения об изменениях в модели (паттерн "Наблюдатель"). Этот класс служит абстрактным базовым классом, который можно расширять для создания конкретных моделей с определённой структурой данных.

#### Конструктор:

`constructor(data: Partial<T>, protected events: IEvents)`

Конструктор принимает данные и объект событий, затем использует `Object.assign` для копирования переданных данных в текущий экземпляр модели. Это позволяет динамически создавать свойства модели на основе входных данных.

Параметры:

- `data: Partial<T>` — частичный объект данных, который будет использоваться для инициализации модели. Это позволяет передавать только те поля, которые необходимы, а остальные будут проинициализированы как `undefined`.
- `events: IEvents` — экземпляр интерфейса `IEvents`, который отвечает за управление событиями. Используется для уведомления подписчиков об изменениях в модели.

##### Поля класса:

`protected events: IEvents`

Назначение: Хранит ссылку на объект событий, который используется для генерации уведомлений об изменениях в модели. Это поле защищено (protected), чтобы оно могло быть доступно только внутри класса и его потомков.

`Динамические поля (из data)`

Назначение: Эти поля создаются динамически на основе переданных данных в конструкторе. Они представляют собой состояние модели и могут содержать любые данные, соответствующие типу T.

##### Методы класса:

$${\color{green}\Large{}\textbf{emitChanges}}$$ Используется для уведомления всех подписчиков о том, что модель изменилась. Он вызывает метод `emit` у объекта `events`, передавая название события и данные. Это позволяет другим частям приложения реагировать на изменения в модели.

Параметры:

- `event: string` — название события, которое будет отправлено подписчикам.
- `payload?: object` — дополнительные данные, которые могут быть переданы вместе с событием. Если параметр не указан, используется пустой объект `{}`.

Возвращаемое значение: `void`

## Model

### 1. Класс `Basket`

Класс `Basket` представляет собой компонент корзины покупок. Он отвечает за отображение списка товаров в корзине, обновление общей стоимости товаров и управление состоянием кнопки оформления заказа.

#### Зона ответственности:

- Отображение списка товаров в корзине.
- Обновление общей стоимости товаров.
- Управление состоянием кнопки оформления заказа (активна/неактивна).
- Генерация событий для взаимодействия с другими компонентами (например, открытие формы заказа).

#### Конструктор:

`constructor(container: HTMLElement, protected events: EventEmitter)`

##### Параметры конструктора:

`container: HTMLElement`
Представляет контейнер, в котором будет отображаться корзина.
Используется для поиска внутренних элементов корзины (список товаров, поле общей стоимости, кнопка).

`events: EventEmitter`
Экземпляр класса `EventEmitter`, который используется для генерации событий (например, открытие формы заказа при клике на кнопку).

##### Логика работы:

Выполняет инициализацию внутренних элементов корзины (`_list`, `_total`, `_button`).
Добавляет обработчик события клика на кнопку оформления заказа, который генерирует событие `order:open`.
Инициализирует список товаров как пустой массив.

##### Поля класса:

`_list: HTMLElement`

- Хранит ссылку на элемент, представляющий список товаров в корзине.
- Используется для добавления или удаления элементов из списка.

`_total: HTMLElement | null`

- Хранит ссылку на элемент, отображающий общую стоимость товаров.
- Если элемент не найден, значение будет `null`.

`_button: HTMLElement | null`

- Хранит ссылку на кнопку оформления заказа.
- Если кнопка не найдена, значение будет `null`.

`items: HTMLElement[] (set)`

- Принимает массив элементов, представляющих товары в корзине.
- Если массив пуст, отображается сообщение "Корзина пуста".

`selected: string[] (set)`

- Принимает массив идентификаторов выбранных товаров.
- Управляет состоянием кнопки оформления заказа (активна, если есть выбранные товары).

`total: number (set)`

- Принимает числовое значение общей стоимости товаров.
- Отображает форматированное значение в элементе `_total`.

##### Методы класса:

$${\color{green}\Large{}\textbf{set items}}$$ Обновляет отображение списка товаров в корзине.

Параметры:
`items: HTMLElement[]` — массив элементов, представляющих товары в корзине.

Логика работы:
Если массив содержит элементы, они заменяют содержимое списка `_list`.
Если массив пуст, в списке отображается сообщение "Корзина пуста".

$${\color{green}\Large{}\textbf{`set selected`}}$$ Управляет состоянием кнопки оформления заказа на основе выбранных товаров.

Параметры:
`items: string[]` — массив идентификаторов выбранных товаров.

Логика работы:
Если массив содержит хотя бы один элемент, кнопка оформления заказа становится активной.
Если массив пуст, кнопка становится неактивной.

$${\color{green}\Large{}\textbf{set total}}$$ Обновляет отображение общей стоимости товаров в корзине.

Параметры:
`total: number` — числовое значение общей стоимости товаров.

Логика работы:
Форматирует значение с помощью функции `formatNumber` и устанавливает его в текстовое содержимое элемента `_total`.

Класс `Basket` инкапсулирует логику работы с корзиной покупок, обеспечивая удобное управление списком товаров, общей стоимостью и состоянием кнопки оформления заказа. Использование сеттеров позволяет легко обновлять состояние корзины извне, а генерация событий через `EventEmitter` обеспечивает взаимодействие с другими компонентами приложения.

## View

### 1. Класс `Form<T>`

### 2. Класс `Modal`

### 3. Класс `Success`

## Presenter

Код презентера не выделен в отдельный класс, а размещен в основном скрипте приложения.
